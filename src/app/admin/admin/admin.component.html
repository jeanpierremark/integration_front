<!-- admin-dashboard.component.html -->
<div class="container-fluid p-0">
  
  <!-- Header avec navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand">
        <i class="bi-shield-check me-2"></i>
        Dashboard Administrateur
      </a>
      
      <div class="navbar-nav ms-auto">
        <div class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
            <i class="bi-person-circle me-1"></i>
            Admin
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#"><i class="bi-gear me-2"></i>Paramètres</a></li>
            <li><a class="dropdown-item" href="#"><i class="bi-box-arrow-right me-2"></i>Déconnexion</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid px-4">
    
    <!-- Navigation par onglets -->
    <ul class="nav nav-pills mb-4">
      <li class="nav-item">
        <button class="nav-link" 
                [class.active]="selectedView === 'overview'"
                (click)="setView('overview')">
          <i class="bi-speedometer2 me-2"></i>Vue d'ensemble
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" 
                [class.active]="selectedView === 'users'"
                (click)="setView('users')">
          <i class="bi-people me-2"></i>Gestion des utilisateurs
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" 
                [class.active]="selectedView === 'activity'"
                (click)="setView('activity')">
          <i class="bi-activity me-2"></i>Journal d'activité
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link" 
                [class.active]="selectedView === 'settings'"
                (click)="setView('settings')">
          <i class="bi-gear me-2"></i>Paramètres système
        </button>
      </li>
    </ul>

    <!-- Vue d'ensemble -->
    <div *ngIf="selectedView === 'overview'">
      
      <!-- Statistiques principales -->
      <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                    Utilisateurs totaux
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.totalUsers }}</div>
                </div>
                <div class="col-auto">
                  <i class="bi-people fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                    Utilisateurs actifs
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.activeUsers }}</div>
                </div>
                <div class="col-auto">
                  <i class="bi-person-check fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                    Nouveaux aujourd'hui
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.newUsersToday }}</div>
                </div>
                <div class="col-auto">
                  <i class="bi-person-plus fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                    Appels API aujourd'hui
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">{{ stats.totalApiCalls }}</div>
                </div>
                <div class="col-auto">
                  <i class="bi-cloud-arrow-down fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Graphiques et métriques -->
      <div class="row">
        <div class="col-lg-8 mb-4">
          <div class="card shadow">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">État du système</h6>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Serveur API</h6>
                  <div class="d-flex align-items-center mb-3">
                    <span class="badge bg-success me-2">
                      <i class="bi-check-circle"></i> En ligne
                    </span>
                    <small class="text-muted">Temps de réponse: 120ms</small>
                  </div>
                  
                  <h6>Utilisation des données</h6>
                  <div class="progress mb-3">
                    <div class="progress-bar bg-info" style="width: 65%"></div>
                  </div>
                  <small class="text-muted">{{ stats.dataUsage }} GB / 200 GB utilisés</small>
                </div>
                
                <div class="col-md-6">
                  <h6>Utilisateurs Premium</h6>
                  <div class="d-flex align-items-center mb-3">
                    <span class="fs-4 fw-bold text-warning me-2">{{ stats.premiumUsers }}</span>
                    <small class="text-muted">abonnés actifs</small>
                  </div>
                  
                  <h6>Utilisateurs suspendus</h6>
                  <div class="d-flex align-items-center">
                    <span class="fs-4 fw-bold text-danger me-2">{{ stats.suspendedUsers }}</span>
                    <small class="text-muted">comptes suspendus</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4 mb-4">
          <div class="card shadow">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Activité récente</h6>
            </div>
            <div class="card-body">
              <div *ngFor="let log of activityLogs.slice(0, 5)" class="d-flex align-items-center mb-3">
                <div class="flex-shrink-0">
                  <i [class]="getActivityTypeIcon(log.type)" [ngClass]="getActivityTypeClass(log.type)"></i>
                </div>
                <div class="flex-grow-1 ms-3">
                  <div class="fw-bold">{{ log.user }}</div>
                  <div class="text-muted small">{{ log.action }}</div>
                  <div class="text-muted small">{{ log.timestamp }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gestion des utilisateurs -->
    <div *ngIf="selectedView === 'users'">
      
      <!-- Filtres et recherche -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row align-items-end">
            <div class="col-md-4">
              <label class="form-label">Rechercher un utilisateur</label>
              <div class="input-group">
                <span class="input-group-text"><i class="bi-search"></i></span>
                <input type="text" class="form-control" placeholder="Nom ou email..." 
                       [(ngModel)]="searchTerm">
              </div>
            </div>
            <div class="col-md-2">
              <label class="form-label">Rôle</label>
              <select class="form-select" [(ngModel)]="selectedRole">
                <option value="all">Tous les rôles</option>
                <option value="admin">Administrateur</option>
                <option value="moderator">Modérateur</option>
                <option value="user">Utilisateur</option>
              </select>
            </div>
            <div class="col-md-2">
              <label class="form-label">Statut</label>
              <select class="form-select" [(ngModel)]="selectedStatus">
                <option value="all">Tous les statuts</option>
                <option value="active">Actif</option>
                <option value="inactive">Inactif</option>
                <option value="suspended">Suspendu</option>
              </select>
            </div>
            <div class="col-md-4 text-end">
              <button class="btn btn-primary me-2">
                <i class="bi-person-plus me-1"></i>Nouvel utilisateur
              </button>
              <button class="btn btn-outline-secondary" (click)="exportUsers()">
                <i class="bi-download me-1"></i>Exporter
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Liste des utilisateurs -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi-people me-2"></i>
            Utilisateurs ({{ filteredUsers.length }})
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Utilisateur</th>
                  <th>Rôle</th>
                  <th>Statut</th>
                  <th>Abonnement</th>
                  <th>Dernière connexion</th>
                  <th>Utilisation</th>
                  <th class="text-center">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of filteredUsers">
                  <td>
                    <div class="d-flex align-items-center">
                      <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3"
                           style="width: 40px; height: 40px;">
                        {{ user.avatar }}
                      </div>
                      <div>
                        <div class="fw-bold">{{ user.name }}</div>
                        <div class="text-muted small">{{ user.email }}</div>
                        <div class="text-muted small">
                          <i class="bi-geo-alt me-1"></i>{{ user.location }}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getRoleClass(user.role)">
                      {{ user.role === 'admin' ? 'Administrateur' : 
                         user.role === 'moderator' ? 'Modérateur' : 'Utilisateur' }}
                    </span>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getStatusClass(user.status)">
                      {{ user.status === 'active' ? 'Actif' : 
                         user.status === 'inactive' ? 'Inactif' : 'Suspendu' }}
                    </span>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="getSubscriptionClass(user.subscription)">
                      {{ user.subscription === 'enterprise' ? 'Entreprise' :
                         user.subscription === 'premium' ? 'Premium' : 'Gratuit' }}
                    </span>
                  </td>
                  <td>
                    <div class="small">{{ user.lastLogin }}</div>
                  </td>
                  <td>
                    <div class="small">
                      <div><strong>{{ user.weatherDataUsage }} MB</strong> données</div>
                      <div><strong>{{ user.apiCalls }}</strong> appels API</div>
                    </div>
                  </td>
                  <td class="text-center">
                    <div class="btn-group btn-group-sm">
                      <button class="btn btn-outline-primary" title="Voir le profil">
                        <i class="bi-eye"></i>
                      </button>
                      <button class="btn btn-outline-secondary" title="Modifier">
                        <i class="bi-pencil"></i>
                      </button>
                      <div class="btn-group" role="group">
                        <button class="btn btn-outline-secondary dropdown-toggle" 
                                data-bs-toggle="dropdown" title="Plus d'actions">
                          <i class="bi-three-dots"></i>
                        </button>
                        <ul class="dropdown-menu">
                          <li *ngIf="user.status !== 'active'">
                            <a class="dropdown-item" (click)="activateUser(user)">
                              <i class="bi-check-circle me-2"></i>Activer
                            </a>
                          </li>
                          <li *ngIf="user.status === 'active'">
                            <a class="dropdown-item" (click)="suspendUser(user)">
                              <i class="bi-pause-circle me-2"></i>Suspendre
                            </a>
                          </li>
                          <li>
                            <a class="dropdown-item" (click)="resetPassword(user)">
                              <i class="bi-key me-2"></i>Réinitialiser le mot de passe
                            </a>
                          </li>
                          <li><hr class="dropdown-divider"></li>
                          <li>
                            <a class="dropdown-item text-danger" (click)="deleteUser(user)">
                              <i class="bi-trash me-2"></i>Supprimer
                            </a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Journal d'activité -->
    <div *ngIf="selectedView === 'activity'">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="bi-activity me-2"></i>
            Journal d'activité
          </h5>
        </div>
        <div class="card-body">
          <div class="timeline">
            <div *ngFor="let log of activityLogs" class="timeline-item">
              <div class="timeline-marker">
                <i [class]="getActivityTypeIcon(log.type)" [ngClass]="getActivityTypeClass(log.type)"></i>
              </div>
              <div class="timeline-content">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h6 class="mb-1">{{ log.action }}</h6>
                    <p class="text-muted mb-1">{{ log.details }}</p>
                    <div class="d-flex align-items-center">
                      <small class="text-muted me-3">
                        <i class="bi-person me-1"></i>{{ log.user }}
                      </small>
                      <small class="text-muted">
                        <i class="bi-clock me-1"></i>{{ log.timestamp }}
                      </small>
                    </div>
                  </div>
                  <span class="badge" [ngClass]="getActivityTypeClass(log.type)">
                    {{ log.type === 'login' ? 'Connexion' :
                       log.type === 'api_call' ? 'API' :
                       log.type === 'data_export' ? 'Export' :
                       log.type === 'subscription' ? 'Compte' : 'Erreur' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paramètres système -->
    <div *ngIf="selectedView === 'settings'">
      <div class="row">
        
        <!-- Paramètres généraux -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi-gear me-2"></i>
                Paramètres généraux
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Nom de l'application</label>
                <input type="text" class="form-control" value="Weather Dashboard">
              </div>
              
              <div class="mb-3">
                <label class="form-label">Limite d'appels API par utilisateur/jour</label>
                <input type="number" class="form-control" value="1000">
              </div>
              
              <div class="mb-3">
                <label class="form-label">Limite de données par utilisateur (MB)</label>
                <input type="number" class="form-control" value="100">
              </div>
              
              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="autoSuspend" checked>
                  <label class="form-check-label" for="autoSuspend">
                    Suspension automatique en cas de dépassement
                  </label>
                </div>
              </div>
              
              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                  <label class="form-check-label" for="emailNotifications">
                    Notifications par email pour les administrateurs
                  </label>
                </div>
              </div>
              
              <button class="btn btn-primary">
                <i class="bi-check2 me-1"></i>Sauvegarder
              </button>
            </div>
          </div>
        </div>

        <!-- Sources de données -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi-cloud me-2"></i>
                Sources de données météo
              </h5>
            </div>
            <div class="card-body">
              
              <!-- Weather API -->
              <div class="d-flex align-items-center justify-content-between p-3 border rounded mb-3">
                <div class="d-flex align-items-center">
                  <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3"
                       style="width: 40px; height: 40px;">
                    <i class="bi-cloud"></i>
                  </div>
                  <div>
                    <h6 class="mb-0">Weather API</h6>
                    <small class="text-muted">API principale</small>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span class="badge bg-success me-2">Actif</span>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" checked>
                  </div>
                </div>
              </div>

              <!-- Open Meteo -->
              <div class="d-flex align-items-center justify-content-between p-3 border rounded mb-3">
                <div class="d-flex align-items-center">
                  <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center me-3"
                       style="width: 40px; height: 40px;">
                    <i class="bi-globe"></i>
                  </div>
                  <div>
                    <h6 class="mb-0">Open Meteo</h6>
                    <small class="text-muted">API de secours</small>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span class="badge bg-success me-2">Actif</span>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" checked>
                  </div>
                </div>
              </div>

              <!-- Visual Crossing -->
              <div class="d-flex align-items-center justify-content-between p-3 border rounded mb-3">
                <div class="d-flex align-items-center">
                  <div class="rounded-circle bg-warning text-white d-flex align-items-center justify-content-center me-3"
                       style="width: 40px; height: 40px;">
                    <i class="bi-graph-up"></i>
                  </div>
                  <div>
                    <h6 class="mb-0">Visual Crossing</h6>
                    <small class="text-muted">Données historiques</small>
                  </div>
                </div>
                <div class="d-flex align-items-center">
                  <span class="badge bg-warning me-2">Maintenance</span>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox">
                  </div>
                </div>
              </div>

              <button class="btn btn-outline-primary btn-sm">
                <i class="bi-plus me-1"></i>Ajouter une source
              </button>
            </div>
          </div>
        </div>

        <!-- Sauvegarde et maintenance -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi-database me-2"></i>
                Sauvegarde et maintenance
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Dernière sauvegarde</label>
                <div class="d-flex align-items-center">
                  <span class="text-muted me-2">{{ getCurrentTime() }}</span>
                  <span class="badge bg-success">Réussie</span>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Prochaine sauvegarde automatique</label>
                <div class="text-muted">Dans 6 heures</div>
              </div>
              
              <div class="d-grid gap-2">
                <button class="btn btn-primary">
                  <i class="bi-download me-1"></i>Créer une sauvegarde maintenant
                </button>
                <button class="btn btn-outline-warning">
                  <i class="bi-arrow-clockwise me-1"></i>Redémarrer les services
                </button>
                <button class="btn btn-outline-danger">
                  <i class="bi-tools me-1"></i>Mode maintenance
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Logs système -->
        <div class="col-lg-6 mb-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi-file-text me-2"></i>
                Logs système
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                  <span>Erreurs (24h)</span>
                  <span class="badge bg-danger">3</span>
                </div>
              </div>
              
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                  <span>Avertissements (24h)</span>
                  <span class="badge bg-warning">12</span>
                </div>
              </div>
              
              <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                  <span>Taille des logs</span>
                  <span class="text-muted">156 MB</span>
                </div>
              </div>
              
              <div class="d-grid gap-2">
                <button class="btn btn-outline-primary">
                  <i class="bi-eye me-1"></i>Voir les logs
                </button>
                <button class="btn btn-outline-secondary">
                  <i class="bi-download me-1"></i>Télécharger les logs
                </button>
                <button class="btn btn-outline-warning">
                  <i class="bi-trash me-1"></i>Nettoyer les anciens logs
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
