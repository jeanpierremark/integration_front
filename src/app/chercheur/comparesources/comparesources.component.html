<div>
<!-- weather-comparison.component.html -->
 <div>
 <div class="bg-gradient-to-r bg-primary text-white p-6 shadow-lg" >
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-graph-up me-3" style="font-size: 2.5rem;"></i>
                        <div style="margin-left: 0px;">
                            <h1  class="h2 fw-bold mb-1" style="margin-top:10px;">Comparer les sources </h1>
                            <p class="text-blue-100 mb-0" style="font-size: 17px;">Comparer les données des sources  </p>
                        </div>
                        <div class="search-bar">
                            <input type="text" class="form-control" placeholder="Recherche..." [(ngModel)]="searchText"/>
                            <i  style="color: #3b82f6; font-size:30px;" class="bi bi-search search-icon" (click)="loadInitialData()" ></i>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    
                    <div class="d-flex justify-content-end align-items-center gap-3">
                        <div class="text-end">
                            <div class="fw-semibold btn bg-light shadow-sm text-primary" id="currentTime">{{dateHeureActuelle$ | async}}</div>
                        </div>
                      <!--<div class="dropdown">
                            <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-gear me-1"></i> Options
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="bi bi-download me-2"></i>Exporter données</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-refresh me-2"></i>Actualiser</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-sliders me-2"></i>Paramètres</a></li>
                            </ul>
                        </div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    <div>
        <!-- Filtres -->
        <div class="bg-white rounded-xl p-4 mb-4 shadow-lg">
            <h2 class="h5 fw-semibold text-dark mb-4 d-flex align-items-center">
            <i class="bi bi-sliders text-primary me-2"></i>
            Filtres et Options
            </h2>
            
            <div class="space-y-4">
            <!-- Sélection du paramètre -->
            <div>
                <label class="form-label fw-medium text-secondary mb-3">
                Paramètre météorologique
                </label>
                <div class="d-flex flex-wrap gap-2">
                <button
                    *ngFor="let param of parameters"
                    (click)="onParameterChange(param.value)"
                    [class]="'btn border-0 d-flex align-items-center gap-2 px-3 py-2 rounded-pill transition-all ' + 
                            (selectedParameter === param.value 
                            ? 'bg-light text-danger shadow-sm' 
                            : 'bg-transparent text-secondary')"
                    style="transition: all 0.2s ease;">
                    <i [class]="'bi ' + param.icon"></i>
                    <span class="small fw-medium">{{ param.label }}</span>
                </button>
                </div>
            </div>

            <!-- Ligne de séparation -->
            <hr class="border-secondary-subtle">

            <!-- Filtres inline -->
            <div class="d-flex flex-wrap align-items-center gap-4">
                
                <!-- Type de graphique avec toggle buttons -->
                <div class="d-flex align-items-center gap-2">
                <span class="form-label fw-medium text-secondary mb-0">Visualisation:</span>
                <div class="btn-group bg-light rounded-lg p-1" role="group">
                    <button
                    *ngFor="let type of chartTypes"
                    (click)="onChartTypeChange(type.value)"
                    [class]="'btn btn-sm d-flex align-items-center gap-2 px-3 py-1 rounded border-0 ' + 
                            (chartType === type.value 
                                ? 'bg-light text-success shadow-sm' 
                                : 'bg-transparent text-secondary')"
                    style="transition: all 0.2s ease;">
                    <i [class]="'bi ' + type.icon"></i>
                    <span class="small fw-medium">{{ type.label }}</span>
                    </button>
                </div>
                </div>

                <!-- Badge d'info -->
                <div class="ms-auto">
                <div class="d-flex align-items-center gap-2 px-3 py-2 bg-gradient-to-r from-indigo-50 to-blue-50 border border-indigo-200 rounded-lg">
                    <div class="bg-success rounded-circle animate-pulse" style="width: 8px; height: 8px;"></div>
                    <span class="small text-primary fw-medium">
                    {{ data.length }} points de données
                    </span>
                </div>
                </div>
            </div>
            </div>
        </div>
    </div>
<!-- Header -->
   <!-- Loading Overlay -->
  <div class="d-flex justify-content-center align-items-center " *ngIf="isLoading">
    <div class="spinner-border" role="status" style="width: 4rem; height: 4rem; color: #3b82f6;"></div>
    </div>
<div class="screen-data">
  <!-- Statistiques -->
  <div class="row g-3 mb-4">
    <div class="col-md-4" *ngFor="let stat of stats">
      <div class="bg-white rounded-xl p-4 shadow-lg h-100">
        <h3 class="h6 fw-semibold text-dark mb-3">{{ stat.name }}</h3>
        <div class="d-flex flex-column gap-2">
          <div class="d-flex justify-content-between">
            <span class="btn border-0 d-flex align-items-center gap-2 px-3 py-2 rounded-pill transition-all bg-white text-secondary shadow-sm">Moyenne</span>
            <span class="btn bg-white text-primary rounded-pill shadow-sm fw-medium ">{{ stat.avg }} {{ getCurrentParameter().unit }}</span>
          </div>
           <div class="d-flex justify-content-between">
            <span class="btn border-0 d-flex align-items-center gap-2 px-3 py-2 rounded-pill transition-all  bg-white text-secondary shadow-sm">Écart-type</span>
            <span class="btn bg-white text-warning rounded-pill shadow-sm fw-medium ">{{ stat.std }} {{ getCurrentParameter().unit }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="btn border-0 d-flex align-items-center gap-2 px-3 py-2 rounded-pill transition-all  bg-white text-secondary shadow-sm">Min</span>
            <span class="btn bg-white text-success rounded-pill shadow-sm fw-medium ">{{ stat.min }} {{ getCurrentParameter().unit }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span class="btn border-0 d-flex align-items-center gap-2 px-3 py-2 rounded-pill transition-all  bg-white text-secondary shadow-sm">Max</span>
            <span class="btn bg-white text-danger rounded-pill shadow-sm fw-medium ">{{ stat.max }} {{ getCurrentParameter().unit }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Graphique principal -->
  <div class="bg-white rounded-xl p-4 shadow-lg">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="h5 fw-semibold text-dark d-flex align-items-center gap-2 mb-0">
        <i [class]="'bi ' + getCurrentParameter().icon + ' text-primary'"></i>
        Comparaison - {{ getCurrentParameter().label }}
      </h2>
      <div class="d-flex align-items-center gap-3 small text-secondary">
        <div class="d-flex align-items-center gap-2">
          <div class="bg-primary rounded-circle" style="width: 12px; height: 12px;"></div>
          Weather API
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="bg-success rounded-circle" style="width: 12px; height: 12px;"></div>
          Open Meteo
        </div>
        <div class="d-flex align-items-center gap-2">
          <div class="rounded-circle" style="width: 12px; height: 12px; background-color: #eb8a1bff;"></div>
          Open Weather
        </div>
      </div>
    </div>
    
    <div style="height: 400px; position: relative;">
      <canvas id="weatherChart"></canvas>
    </div>
  </div>
</div>
</div>

